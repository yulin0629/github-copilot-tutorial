---
mode: "edit"
description: "程式碼重構最佳實踐"
---

# 程式碼重構指南

請對指定的程式碼進行重構，遵循現代化的最佳實踐：

## 🎯 **重構目標**
- 提升程式碼可讀性和可維護性
- 減少重複代碼 (DRY 原則)
- 改善效能和記憶體使用
- 增強錯誤處理能力
- 符合 SOLID 設計原則

## 🔍 **程式碼異味檢測**
### 需要重構的跡象：
- [ ] **長函數** (超過 20-30 行)
- [ ] **重複代碼** (相同邏輯出現多次)
- [ ] **大型類別** (過多職責)
- [ ] **長參數列表** (超過 3-4 個參數)
- [ ] **全域變數** (狀態管理混亂)
- [ ] **魔術數字** (硬編碼的常數)
- [ ] **深層巢狀** (超過 3 層的 if/for)
- [ ] **複雜條件** (難以理解的邏輯判斷)

## 🛠️ **重構技術**

### 1. **函數重構**
```javascript
// 提取函數 (Extract Function)
// 內聯函數 (Inline Function)
// 重新命名函數 (Rename Function)
// 移動函數 (Move Function)
```

### 2. **變數重構**
```javascript
// 提取變數 (Extract Variable)
// 內聯變數 (Inline Variable)
// 重新命名變數 (Rename Variable)
// 分解臨時變數 (Split Temporary Variable)
```

### 3. **類別重構**
```javascript
// 提取類別 (Extract Class)
// 內聯類別 (Inline Class)
// 移動欄位 (Move Field)
// 移動方法 (Move Method)
```

## 🎨 **現代化改進**

### ES6+ 語法升級
- [ ] 使用 `const`/`let` 替代 `var`
- [ ] 使用箭頭函數適當場合
- [ ] 實作解構賦值 (Destructuring)
- [ ] 使用樣板字面值 (Template Literals)
- [ ] 採用模組化 import/export
- [ ] 使用 async/await 替代 callback

### 函數式編程改進
- [ ] 使用 `map`、`filter`、`reduce`
- [ ] 避免變異 (Immutability)
- [ ] 使用純函數 (Pure Functions)
- [ ] 實作高階函數 (Higher-order Functions)

## 🔒 **錯誤處理改進**
### 要求：
- [ ] 使用 try-catch 適當包裝
- [ ] 提供有意義的錯誤訊息
- [ ] 避免忽略錯誤
- [ ] 實作錯誤邊界 (Error Boundaries)
- [ ] 加入輸入驗證

## 📊 **效能優化**
### 檢查項目：
- [ ] 避免不必要的計算
- [ ] 使用適當的資料結構
- [ ] 實作記憶化 (Memoization)
- [ ] 減少 DOM 操作
- [ ] 優化迴圈效能

## 🧪 **可測試性改進**
### 要求：
- [ ] 分離業務邏輯和 UI 邏輯
- [ ] 減少外部依賴
- [ ] 使用依賴注入
- [ ] 提供純函數介面
- [ ] 加入適當的抽象層

## 📝 **重構步驟**
1. **分析現有代碼** - 識別問題和改進機會
2. **制定重構計劃** - 確定重構優先順序
3. **小步驟重構** - 每次只做一個小改動
4. **測試驗證** - 確保功能未被破壞
5. **文件更新** - 更新相關註解和文件

## 📋 **重構報告格式**
### 🔧 執行的重構
- **重構類型**: [提取函數/重新命名/移動等]
- **原因**: [為什麼需要這個重構]
- **改進**: [具體的改進效果]

### 📈 改進總結
- **可讀性**: [改進描述]
- **效能**: [效能提升]
- **可維護性**: [維護性改善]
- **測試覆蓋**: [測試改進]

### ⚠️ 注意事項
- [重構後需要注意的事項]
- [可能的風險或副作用]

請對提供的程式碼進行系統性的重構改進。