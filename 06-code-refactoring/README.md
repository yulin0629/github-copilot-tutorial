# 場景 6：程式碼重構

## 🎯 學習目標
- 掌握進階 **edit mode** 技巧
- 學習結合 **@workspace** 進行大規模重構
- 體驗 Copilot 在保持程式碼品質上的協助
- 了解如何安全地重構遺留程式碼

## 📝 場景說明
您接手了一個遺留的電子商務系統，程式碼結構混亂、重複邏輯多、缺乏現代化的設計模式。需要進行系統性的重構，提升程式碼品質和可維護性。

## 🛠️ 初始專案結構
```
06-code-refactoring/
├── README.md (本檔案)
├── package.json
├── legacy-code/
│   ├── monolith.js (單體架構檔案)
│   ├── utils-old.js (舊工具函數)
│   └── api-old.js (舊 API 實作)
├── refactored/
│   ├── models/ (重構後的模型)
│   ├── services/ (重構後的服務)
│   ├── controllers/ (重構後的控制器)
│   └── utils/ (重構後的工具)
└── refactoring-steps.md (重構步驟記錄)
```

## 📚 Demo 劇本

### 步驟 1：分析遺留程式碼結構
```
@workspace 分析 legacy-code 目錄中的程式碼，識別重構的機會和潛在問題
```

### 步驟 2：提取重複邏輯
1. 選取重複的程式碼區塊
2. 使用 inline chat：
```
將這段重複的邏輯提取為獨立的函數，並在所有使用處替換
```

### 步驟 3：模組化大型函數
```
這個函數太長了，請幫我將它拆分為多個職責單一的小函數
```

### 步驟 4：引入設計模式
```
重構這個類別，引入適當的設計模式（工廠模式、策略模式等）
```

### 步驟 5：現代化語法
```
@workspace 將這個專案的程式碼從 ES5 升級到 ES6+，使用現代 JavaScript 語法
```

## 💡 重點提示

### 重構策略：
1. **小步快跑**：每次只重構一個小部分
2. **保持功能不變**：重構不改變外部行為
3. **測試驅動**：重構前後都要有測試保護
4. **逐步演進**：從最痛點的地方開始

### Edit Mode 進階技巧：
1. **選取範圍重構**：選取特定程式碼區塊進行重構
2. **批次替換**：同時處理多個相似的重構
3. **保持一致性**：確保重構後的程式碼風格一致
4. **段落式重構**：分段進行大型重構

### @workspace 在重構中的應用：
1. **影響分析**：了解修改對其他檔案的影響
2. **依賴追蹤**：找出所有相關的引用
3. **架構建議**：獲得整體架構改進建議
4. **命名一致性**：確保跨檔案的命名一致

## 🎬 Demo 重點
1. 展示如何安全地重構遺留程式碼
2. 示範 @workspace 在大規模重構中的價值
3. 強調重構的安全性和測試的重要性
4. 展現現代化程式碼的優勢

## 📝 常用重構提示詞

### 結構重構：
```
將這個單體函數拆分為多個職責單一的函數
提取這段程式碼的共同邏輯為工具函數
重組這個類別的方法，按功能分組
```

### 設計模式：
```
引入工廠模式來創建物件
使用策略模式重構這個條件判斷
應用觀察者模式來解耦這些組件
```

### 現代化：
```
將這個回調函數重構為 Promise/async-await
使用解構賦值簡化這個函數參數
應用 ES6 模組語法重構這個檔案
```

## ✅ 預期成果
完成本場景後，您應該：
- 能夠識別和重構程式碼異味
- 掌握使用 Copilot 進行安全重構的技巧
- 了解如何結合 @workspace 進行大規模重構
- 學會現代化遺留程式碼的方法

## 🔍 延伸練習
1. 重構一個真實的遺留專案
2. 建立重構檢查清單
3. 實作重構前後的效能對比
4. 設計重構的自動化流程

## 🎯 挑戰任務
1. 將單體架構重構為微服務架構
2. 引入 TypeScript 並重構類型定義
3. 重構為更好的錯誤處理機制
4. 優化程式碼的可測試性